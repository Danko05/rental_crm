{% extends 'base.html' %}

{% block title %}Каталог автомобілів{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <a href="javascript:history.back()" class="btn btn-outline-secondary mb-3">
            <i class="bi bi-arrow-left"></i> Назад
        </a>
        <h2><i class="bi bi-grid"></i> Каталог автомобілів</h2>
    </div>
</div>

<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-body">
                <form method="get" class="row g-3">
                    <div class="col-md-2">
                        <label for="{{ form.brand.id_for_label }}" class="form-label">{{ form.brand.label }}</label>
                        {{ form.brand }}
                    </div>
                    <div class="col-md-2">
                        <label for="{{ form.price_from.id_for_label }}" class="form-label">{{ form.price_from.label }}</label>
                        {{ form.price_from }}
                    </div>
                    <div class="col-md-2">
                        <label for="{{ form.price_to.id_for_label }}" class="form-label">{{ form.price_to.label }}</label>
                        {{ form.price_to }}
                    </div>
                    <div class="col-md-2">
                        <label for="{{ form.rental_start_date.id_for_label }}" class="form-label">{{ form.rental_start_date.label }}</label>
                        {{ form.rental_start_date }}
                    </div>
                    <div class="col-md-2">
                        <label for="{{ form.rental_end_date.id_for_label }}" class="form-label">{{ form.rental_end_date.label }}</label>
                        {{ form.rental_end_date }}
                    </div>
                    <div class="col-md-2">
                        <label class="form-label">&nbsp;</label>
                        <button type="submit" class="btn btn-primary w-100">
                            <i class="bi bi-search"></i> Пошук
                        </button>
                    </div>
                </form>
                {% if form.rental_start_date.value and form.rental_end_date.value %}
                {# Повідомлення приховано за запитом користувача #}
                {% elif form.rental_start_date.value or form.rental_end_date.value %}
                <div class="mt-2">
                    <div class="alert alert-warning mb-0">
                        <i class="bi bi-exclamation-triangle"></i> 
                        Вкажіть обидві дати для перевірки доступності
                    </div>
                </div>
                {% else %}
                <div class="mt-2">
                    <small class="text-muted">
                        <i class="bi bi-info-circle"></i> 
                        Показано всі автомобілі. Вкажіть дати оренди, щоб побачити тільки доступні на цей період
                    </small>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<div class="row">
    {% for item in cars_with_availability %}
    <div class="col-md-4 mb-4">
        <div class="card h-100 {% if has_dates and item.is_busy %}opacity-75{% endif %}">
            {% if item.car.photo %}
            <img src="{{ item.car.photo.url }}" class="card-img-top" alt="{{ item.car }}" style="height: 200px; object-fit: cover;">
            {% else %}
            <div class="card-img-top bg-light d-flex align-items-center justify-content-center" style="height: 200px;">
                <i class="bi bi-car-front" style="font-size: 4rem; color: #ccc;"></i>
            </div>
            {% endif %}
            <div class="card-body">
                <h5 class="card-title">
                    {{ item.car.brand }} {{ item.car.model }}
                    {% if has_dates and item.is_busy %}
                    <span class="badge bg-danger ms-2">Орендовано</span>
                    {% endif %}
                </h5>
                <p class="card-text">
                    <small class="text-muted">
                        <i class="bi bi-calendar"></i> {{ item.car.year }} рік<br>
                        <i class="bi bi-tag"></i> {{ item.car.car_type }}<br>
                        <i class="bi bi-currency-hryvnias"></i> {{ item.car.daily_price }} грн/доба
                    </small>
                </p>
                {% if has_dates %}
                    {% if item.is_busy %}
                    <button type="button" class="btn btn-secondary" disabled title="Автомобіль зайнятий на вибрані дати">
                        <i class="bi bi-lock"></i> Детальніше
                    </button>
                    {% else %}
                    <a href="{% url 'client:car_detail' item.car.id %}" class="btn btn-primary">
                        Детальніше
                    </a>
                    {% endif %}
                {% else %}
                <a href="{% url 'client:car_detail' item.car.id %}" class="btn btn-primary">
                    Детальніше
                </a>
                {% endif %}
            </div>
        </div>
    </div>
    {% empty %}
    <div class="col-12">
        <div class="alert alert-info">
            <i class="bi bi-info-circle"></i> Автомобілів не знайдено
        </div>
    </div>
    {% endfor %}
</div>
{% endblock %}

